<%- include('layout/header', {}) %>

<header>
    <h1><%= list.title %></h1>
</header>

<nav>
<%- include('partials/listTree', { items: lists }) %>
</nav>

<section class="main">
    <table>
        <thead>
            <tr>
                <th>&nbsp;<!-- Priority (implicit) --></th>
                <th>&nbsp;<!-- has children (implicit) --></th>
                <th>&nbsp;<!-- Title (implicit) --></th>
                <th>Start</th>
                <th>Due</th>
            </tr>
        </thead>
        <tbody>
            <% tasks.forEach(task => { %>
                <tr>
                    <td>
                        <% if (task.priority) { %>
                            <%= task.priority %> 
                        <% } %>
                    </td>
                    <td>
                        <% if (task.children.length != 0) { %>
                            &gt;
                        <% } %>
                    </td>
                    <td>
                        <% if (task.status === "completed") { %>
                            <input type="checkbox" readonly checked />
                            <%= task.title %>
                        <% } else if (task.status === "canceled") { %>
                            <s>
                                <input type="checkbox" readonly />
                                <%= task.title %>
                            </s>
                        <% } else { %>
                            <input type="checkbox" readonly />
                            <%= task.title %>
                        <% } %>
        
                        <% if (task.notes) { %>
                            <!-- TODO remove BR -->
                            <br />
                            <small>
                                <%= task.notes.text %> 
                            </small>
                        <% } %>
                    </td>
                    <td>
                        <% if (task.start_date) { %>
                            <%= dateformat(task.start_date, "yyyy/mm/dd") %> 
                        <% } %>
                    </td>
                    <td>
                        <% if (task.due_date) { %>
                            <%= dateformat(task.due_date, "yyyy/mm/dd") %> 
                        <% } %>
                    </td>
                </tr>
                <!-- TODO: nested children -->
                <% task.children.forEach(task => { %>
                    <tr>
                        <td>
                            <% if (task.priority) { %>
                                <%= task.priority %> 
                            <% } %>
                        </td>
                        <td>
                            <% if (task.children.length != 0) { %>
                                &gt;
                            <% } %>
                        </td>
                        <td>
                            ---
                            <% if (task.status === "completed") { %>
                                <input type="checkbox" readonly checked />
                                <%= task.title %>
                            <% } else if (task.status === "canceled") { %>
                                <s>
                                    <input type="checkbox" readonly />
                                    <%= task.title %>
                                </s>
                            <% } else { %>
                                <input type="checkbox" readonly />
                                <%= task.title %>
                            <% } %>
            
                            <% if (task.notes) { %>
                                <!-- TODO remove BR -->
                                <br />
                                <small>
                                    <%= task.notes.text %> 
                                </small>
                            <% } %>
                        </td>
                        <td>
                            <% if (task.start_date) { %>
                                <%= dateformat(task.start_date, "yyyy/mm/dd") %> 
                            <% } %>
                        </td>
                        <td>
                            <% if (task.due_date) { %>
                                <%= dateformat(task.due_date, "yyyy/mm/dd") %> 
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            <% }) %>
        </tbody>
    </table>
</section>

<%- include('layout/footer', {}) %>